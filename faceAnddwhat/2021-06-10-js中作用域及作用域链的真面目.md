### 作用域

- 定义：将作用域定义为一套规则，用于管理引擎如何在当前作用域以及嵌套的子作用域中根据标识名称（变量名或函数名）进行变量查找（可理解为该上下文中声明的变量和声明的作用范围）

- 分类：
  - 全局作用域
  - 块级作用域
  - 函数作用域

- 特性：
  - 声明提前：一个声明在函数体内都是可见的函数优先于变量
  - 非匿名自执行函数，函数变量为只读状态，无法修改

#### 定义

> 作用域是指在程序中定义变量的区域，该位置决定了变量的生命周期。
> 简而言之，作用域就是变量与函数的可访问范围，即作用域控制着变量和函数的<span style="color: red">可见性</span>和<span style="color: red">生命周期</span>。

### 分类

- 全局作用域
  - 该作用域中的对象在代码的任何地方都可以访问，其生命周期伴随着页面的生命周期。
  - window上的属性（在浏览器中）
  - 最外层的函数
  - 最外层定义的变量（let、const、var）
  - 未定义直接赋值的变量
  - js规定的全局对象的属性，三个值（Infinity、NaN、undefined）、九个函数（parseInt、parsetFloat、decodeURI、encodeURI...）、一些构造器（Date、Array等）、四个用于当作命名空间的对象（Atomics、JSON、Math、Reflect）。
  
 - 函数作用域
  - 在函数内部定义的变量或者函数，并且定义的变量或者函数只能在函数内部被访问。函数执行结束，函数内定义的变量会被销毁。

- 块级作用域
  - 简而言之就是使用一对大括号{}包裹的一段代码，通过单独的大括号、if块、while块、for块、try/catch/finally等都会产生块级作用域。

### 作用域链

#### 定义

> 在每个执行上下文的变量环境中，都包含一个外部引用（成为outer），用于指向外部的指向上下文。当在查找一个变量时
> 如果在当前的变量环境中没有找到，js引擎会继续在outer所指向的执行上下文中查找，把这个查找的链条称为作用域链。
> （作用域链可以理解为一组对象列表，包含父级和自身的变量对象，因此我们便能通过作用域链访问到父级生命的变量或者函数）

#### 组成

- 作用域链由两部分组成，分别是`[[scope]]`和AO
  - `[[scope]]`属性：指向父级变量和作用域链，也包含了父级的`[[scope]]`和AO
  - AO：自身活动对象，也就是该执行上下文中的变量对象
  - 如此 `[[scope]]`包含`[[scope]]`，便自上而下形成一条 链式作用域。

#### 查找规则

1. 从当前的执行作用域开始查找变量
2. 如果在当前作用域中没有找到，则向上一级进行查找
3. 继续向上一级查找，直到最外层的全局作用域

```js
  var val1 = 10;
  function fun1() {
    var val2 = 20;
    function fun2() {
      var val3 = 30;
      console.log(val1 + val2 + val3)
    }
    fun2();
  }
  fun1();
```

![查找过程](https://mmbiz.qpic.cn/mmbiz_png/q4qrl2ddrUsrwqSfFjkX7mRyeq54CpxIiaicfdOHftWI2YPaTHXNnlMXSU2WHYQnc1XeQMyPuHCxWTFLNAHm9uFw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)
